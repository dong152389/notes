(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{1115:function(a,s,t){a.exports=t.p+"assets/img/Lusifer_20190111041121.708c8502.png"},1116:function(a,s,t){a.exports=t.p+"assets/img/Lusifer_20190111043201.06e4b194.png"},1117:function(a,s,t){a.exports=t.p+"assets/img/Lusifer_20190111043322.753bc0d7.png"},1118:function(a,s,t){a.exports=t.p+"assets/img/Lusifer_20190111043538.33b16aed.png"},1666:function(a,s,t){"use strict";t.r(s);var r=t(26),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,r=a._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"nacos-config-多环境的配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nacos-config-多环境的配置"}},[a._v("#")]),a._v(" Nacos Config 多环境的配置")]),a._v(" "),r("h2",{attrs:{id:"spring-boot-profile"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-profile"}},[a._v("#")]),a._v(" Spring Boot Profile")]),a._v(" "),r("p",[a._v("我们在做项目开发的时候，生产环境和测试环境的一些配置可能会不一样，有时候一些功能也可能会不一样，所以我们可能会在上线的时候手工修改这些配置信息。但是 Spring 中为我们提供了 Profile 这个功能。我们只需要在启动的时候添加一个虚拟机参数，激活自己环境所要用的 Profile 就可以了。")]),a._v(" "),r("p",[a._v("操作起来很简单，只需要为不同的环境编写专门的配置文件，如："),r("code",[a._v("application-dev.yml")]),a._v("、"),r("code",[a._v("application-prod.yml")]),a._v("， 启动项目时只需要增加一个命令参数 "),r("code",[a._v("--spring.profiles.active=环境配置")]),a._v(" 即可，启动命令如下：")]),a._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("java -jar hello-spring-cloud-alibaba-nacos-provider-1.0.0-SNAPSHOT.jar --spring.profiles.active"),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("prod\n")])])]),r("h2",{attrs:{id:"nacos-config-profile"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nacos-config-profile"}},[a._v("#")]),a._v(" Nacos Config Profile")]),a._v(" "),r("p",[a._v("spring-cloud-starter-alibaba-nacos-config 在加载配置的时候，不仅仅加载了以 dataid 为 "),r("code",[a._v("${spring.application.name}.${file-extension:properties}")]),a._v(" 为前缀的基础配置，还加载了 dataid 为 "),r("code",[a._v("${spring.application.name}-${profile}.${file-extension:properties}")]),a._v(" 的基础配置。在日常开发中如果遇到多套环境下的不同配置，可以通过 Spring 提供的 "),r("code",[a._v("${spring.profiles.active}")]),a._v(" 这个配置项来配置。")]),a._v(" "),r("p",[a._v("此处我们以之前创建的 "),r("RouterLink",{attrs:{to:"/spring-cloud-alibaba/创建服务提供者.html#创建服务提供者"}},[r("strong",[a._v("服务提供者")])]),a._v(" 项目为例")],1),a._v(" "),r("h3",{attrs:{id:"在-nacos-server-中增加配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#在-nacos-server-中增加配置"}},[a._v("#")]),a._v(" 在 Nacos Server 中增加配置")]),a._v(" "),r("p",[a._v("增加一个名为 "),r("code",[a._v("nacos-provider-config-prod.yaml")]),a._v(" 的配置")]),a._v(" "),r("p",[r("img",{attrs:{src:t(1115),alt:"img"}})]),a._v(" "),r("p",[r("strong",[a._v("注意：此时，我将配置文件中的端口由 "),r("code",[a._v("8081")]),a._v(" -> "),r("code",[a._v("8082")])])]),a._v(" "),r("h3",{attrs:{id:"在项目中增加配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#在项目中增加配置"}},[a._v("#")]),a._v(" 在项目中增加配置")]),a._v(" "),r("p",[a._v("增加一个名为 "),r("code",[a._v("bootstrap-prod.properties")]),a._v(" 的配置文件，内容如下：")]),a._v(" "),r("div",{staticClass:"language-properties extra-class"},[r("pre",{pre:!0,attrs:{class:"language-properties"}},[r("code",[r("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.profiles.active")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),r("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("prod")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.application.name")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),r("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("nacos-provider-config")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.cloud.nacos.config.file-extension")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),r("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("yaml")]),a._v("\n"),r("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.cloud.nacos.config.server-addr")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),r("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("127.0.0.1:8848")]),a._v("\n")])])]),r("p",[a._v("主要增加了 "),r("code",[a._v("spring.profiles.active=prod")]),a._v(" 配置，用于指定访问 Nacos Server 中的 "),r("code",[a._v("nacos-provider-config-prod.yaml")]),a._v(" 配置")]),a._v(" "),r("h2",{attrs:{id:"启动应用程序"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启动应用程序"}},[a._v("#")]),a._v(" 启动应用程序")]),a._v(" "),r("p",[a._v("此时我们有两个配置文件，分别为 "),r("code",[a._v("bootstrap.properties")]),a._v(" 和 "),r("code",[a._v("bootstrap-prod.properties")]),a._v(" ，我们需要指定启动时加载哪一个配置文件，操作流程如下：")]),a._v(" "),r("ul",[r("li",[r("code",[a._v("Run")]),a._v(" -> "),r("code",[a._v("Edit Configurations..")])])]),a._v(" "),r("p",[r("img",{attrs:{src:t(1116),alt:"img"}})]),a._v(" "),r("ul",[r("li",[a._v("设置需要激活的配置")])]),a._v(" "),r("p",[r("img",{attrs:{src:t(1117),alt:"img"}})]),a._v(" "),r("ul",[r("li",[a._v("观察日志，判断是否成功加载配置")])]),a._v(" "),r("p",[r("img",{attrs:{src:t(1118),alt:"img"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);