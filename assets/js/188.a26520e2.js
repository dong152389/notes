(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{1094:function(t,a,s){t.exports=s.p+"assets/img/Lusifer_20190510144633.95f7a6a6.png"},1621:function(t,a,s){"use strict";s.r(a);var n=s(26),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"配置-kubeadm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubeadm"}},[t._v("#")]),t._v(" 配置 kubeadm")]),t._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),n("p",[t._v("安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。")]),t._v(" "),n("h2",{attrs:{id:"创建并修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建并修改配置"}},[t._v("#")]),t._v(" 创建并修改配置")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出配置文件")]),t._v("\nkubeadm config print init-defaults --kubeconfig ClusterConfiguration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubeadm.yml\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改配置为如下内容")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改为主节点 IP")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.141.130\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/dockershim.sock\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controlPlaneEndpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CoreDNS\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内不能访问 Google，修改为阿里云")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.aliyuncs.com/google_containers\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改版本号")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1.14.1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置成 Calico 的默认网段")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSubnet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.0/16"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启 IPVS 模式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeproxy.config.k8s.io/v1alpha1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" KubeProxyConfiguration\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("featureGates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SupportIPVSProxyMode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ipvs\n")])])]),n("h2",{attrs:{id:"查看和拉取镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看和拉取镜像"}},[t._v("#")]),t._v(" 查看和拉取镜像")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所需镜像列表")]),t._v("\nkubeadm config images list --config kubeadm.yml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取镜像")]),t._v("\nkubeadm config images pull --config kubeadm.yml\n")])])]),n("p",[n("img",{attrs:{src:s(1094),alt:"img"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);