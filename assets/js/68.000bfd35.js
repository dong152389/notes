(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{1571:function(t,a,s){"use strict";s.r(a);var e=s(26),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"基于-ha-机制的-mycat-高可用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于-ha-机制的-mycat-高可用"}},[t._v("#")]),t._v(" 基于 HA 机制的 Mycat 高可用")]),t._v(" "),e("p",[t._v("在实际项目中， Mycat 服务也需要考虑高可用性，如果 Mycat 所在服务器出现宕机，或 Mycat 服务故障，需要有备机提供服务，需要考虑 Mycat 集群。")]),t._v(" "),e("h2",{attrs:{id:"高可用方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高可用方案"}},[t._v("#")]),t._v(" 高可用方案")]),t._v(" "),e("p",[t._v("我们可以使用 HAProxy + Keepalived 配合两台 Mycat 搭起 Mycat 集群，实现高可用性。 HAProxy实现了 MyCat 多节点的集群高可用和负载均衡， 而 HAProxy 自身的高可用则可以通过 Keepalived 来实现。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(890),alt:""}})]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("角色")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("IP")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("账号")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("密码")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("MyCat1")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.11")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("MyCat2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.12")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("HAProxy（master）")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.11")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("Keepalived（master）")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.11")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("HAProxy（backup）")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.12")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("Keepalived（backup）")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.12")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("111111")])])])]),t._v(" "),e("p",[t._v("为了方便的搭建选择了2台机器，实际应该是4台机器。")]),t._v(" "),e("h2",{attrs:{id:"安装配置-haproxy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-haproxy"}},[t._v("#")]),t._v(" 安装配置 HAProxy")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#docker-compose.yml")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("haproxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haproxy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.5.18\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haproxy1\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7777:7777"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"48066:48066"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./haproxy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/haproxy\n\n")])])]),e("div",{staticClass:"language-properties extra-class"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#haproxy.cfg")]),t._v("\nglobal\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        log")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1 local0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        maxconn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("4096")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        chroot")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/etc/haproxy")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        pidfile")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/etc/haproxy/haproxy.pid")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        uid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("99")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        gid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("99")]),t._v("\n        daemon\ndefaults\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        mode")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("           tcp")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         httplog")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         abortonclose")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        monitor-uri")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("    /monitoruri")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        maxconn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("        2000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("client  30s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        retries")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("        3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("redispatch")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("connect 5s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("server  5s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("uri       /status")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listen")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("proxy_status")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        bind")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("48066")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        mode")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tcp")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        balance")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("roundrobin")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mycat_1 192.168.25.12:8066 check inter 10s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mycat_2 192.168.25.11:8066 check inter 10s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("frontend")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("admin_stats")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        bind")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("7777")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        mode")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("http")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("enable")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        option")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("httplog")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        maxconn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("refresh 30s")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("uri /admin")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("auth admin:admin")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hide-version")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        stats")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("admin if TRUE")]),t._v("\n")])])]),e("p",[t._v("打开浏览器访问 http://192.168.25.11:7777/admin，在弹出框中输入admin账号密码。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(891),alt:""}})]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#验证负载均衡，通过HAProxy访问Mycat")]),t._v("\nmysql "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("umycat "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p111111 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("168.25")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".11")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("P48066\n")])])]),e("p",[t._v("按照同样的操作在另一台计算机上搭建HAProxy。")]),t._v(" "),e("h2",{attrs:{id:"安装keepalived"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装keepalived"}},[t._v("#")]),t._v(" 安装Keepalived")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived –y\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看是否安装成功")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" -qa"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" keepalived\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改 keepalived.conf")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/keepalived\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" keepalived.conf\n")])])]),e("p",[e("img",{attrs:{src:s(892),alt:""}})]),t._v(" "),e("div",{staticClass:"language-properties extra-class"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keepalived.conf")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("global_defs")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  notification_email")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n    xlcocoon@foxmail.com\n  }\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  notification_email_from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("keepalived@showjoy.com")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  smtp_server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  smtp_connect_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("30")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  router_id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("LVS_DEVEL")]),t._v("\n  vrrp_skip_check_adv_addr\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  vrrp_garp_interval")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("  vrrp_gna_interval")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n}\n\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("vrrp_instance")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("VI_1 {")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #主机配MASTER，备机配BACKUP")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    state")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("MASTER")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #所在机器网卡")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    interface")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ens33")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    virtual_router_id")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("51")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #数值越大优先级越高，备机不要超过主机")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    priority")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    advert_int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    authentication")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        auth_type")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("PASS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        auth_pass")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("111111")]),t._v("\n    }\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    virtual_ipaddress")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #虚拟IP")]),t._v("\n        192.168.25.200\n    }\n}\n\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("virtual_server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.25.200 48066 {")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    delay_loop")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("6")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    lb_algo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("rr")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    lb_kind")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("NAT")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    persistence_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("50")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    protocol")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("TCP")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    real_server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.25.11 48066 {")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        weight")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        TCP_CHECK")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        connect_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        retry")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        delay_before_retry")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n      }\n    }\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    real_server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.25.12 48066 {")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        weight")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        TCP_CHECK")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            connect_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            nb_get_retry")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            delay_before_retry")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n        }\n    }\n}\n")])])]),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启keeplived")]),t._v("\nsystemctl restart keepalived.service\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#登录验证")]),t._v("\nmysql -umycat -p111111 -h192.168.25.200 -P48066\n")])])]),e("h2",{attrs:{id:"测试高可用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试高可用"}},[t._v("#")]),t._v(" 测试高可用")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入mycat")]),t._v("\nmysql "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("umycat "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p111111 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("168.25")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".200")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("P48066\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询orders表")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" orders"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭一台Mycat")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 再吃查询，会看到如下图效果")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:s(893),alt:""}})]),t._v(" "),e("p",[t._v("先是报错找不到链接，很快就又显示了结果。")])])}),[],!1,null,null,null);a.default=n.exports},890:function(t,a,s){t.exports=s.p+"assets/img/XloIET.md.1a371057.png"},891:function(t,a,s){t.exports=s.p+"assets/img/134101.7a019ab0.png"},892:function(t,a,s){t.exports=s.p+"assets/img/135655.a63f2e58.png"},893:function(t,a,s){t.exports=s.p+"assets/img/142938.a8891429.png"}}]);