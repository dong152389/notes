(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1574:function(t,a,s){"use strict";s.r(a);var n=s(26),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"搭建读写分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建读写分离"}},[t._v("#")]),t._v(" 搭建读写分离")]),t._v(" "),n("h2",{attrs:{id:"一主一从"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一主一从"}},[t._v("#")]),t._v(" 一主一从")]),t._v(" "),n("p",[t._v("修改MySQL配置文件")]),t._v(" "),n("h3",{attrs:{id:"主节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主节点"}},[t._v("#")]),t._v(" 主节点")]),t._v(" "),n("p",[t._v("修改my.cnf")]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[t._v("[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器唯一ID，默认是1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 开启二进制日志功能")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ms-mysql-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定不需要同步的数据库名称, 可指定多个")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("sys")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("information_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("performance_schema")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定同步的数据库，可指定多个")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-do-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("testdb")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志使用内存大小（事务）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_cache_size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1M")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志格式(mixed, statement,row)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# statement: 将写操作语句添加到binlog,然后在slave机运行。缺点：语句中有now()时，会造成数据不一致")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# row: 记录每一行的改变,然后在slave机更新。缺点：批量更新时，会在slave机执行大量update")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mixed: 有类似now()这种会造成数据不一致的函数时，使用row模式，否则还是使用statement模式。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mixed")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志过期清理时间，默认2592000秒（30天），604800秒（7天）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_expire_logs_seconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("604800")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave复制中断")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica_skip_errors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1062")]),t._v("\n")])])]),n("h3",{attrs:{id:"从节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从节点"}},[t._v("#")]),t._v(" 从节点")]),t._v(" "),n("p",[t._v("my.cnf")]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[t._v("[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## serverId,局域网内唯一")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server_id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定不需要同步的数据库名称")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("sys")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("information_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("performance_schema")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 开启二进制日志功能")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ms-mysql-slave11-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志使用内存大小（事务）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_cache_size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1M")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志格式(mixed, statement,row)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mixed")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 二进制日志过期清理时间，默认2592000秒（30天），604800秒（7天）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_expire_logs_seconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("604800")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave复制中断")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica_skip_errors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1062")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## relay_log配置slave的中继日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("relay_log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ms-mysql-relay-bin")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 将复制事件写进自己的二进制日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_slave_updates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 设置为只读（super权限用户除外）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("read_only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n")])])]),n("h3",{attrs:{id:"授权账户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权账户"}},[t._v("#")]),t._v(" 授权账户")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在主节点MySQL里执行授权命令")]),t._v("\nCREATE "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),t._v(" IDENTIFIED WITH mysql_native_password BY "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'111111'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nGRANT REPLICATION SLAVE ON *.* TO "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询master的状态")]),t._v("\nshow master status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#记录下File和Position的值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#执行完此步骤后不要再操作主服务器MySQL，防止主服务器状态值变化")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:s(902),alt:""}})]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在从节点输入刚刚记录的值")]),t._v("\nCHANGE MASTER TO\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_HOST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.25.11'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#为Master节点地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v(",\t\t "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#为刚刚创建的账户")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'111111'")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_LOG_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ms-mysql-bin.000002'")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_LOG_POS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("653")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:s(903),alt:""}})]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动从服务器复制功能")]),t._v("\nstart slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看从服务器状态")]),t._v("\nshow slave status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:s(904),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"修改mycat配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改mycat配置文件"}},[t._v("#")]),t._v(" 修改MyCat配置文件")]),t._v(" "),n("p",[n("strong",[t._v("之前的配置已分配了读写主机，是否已实现读写分离？")])]),t._v(" "),n("p",[t._v("验证读写分离")]),t._v(" "),n("ol",[n("li",[t._v("在写主机插入： insert into test values (1,@@hostname);")]),t._v(" "),n("li",[t._v("在Mycat里查询： select * from test;")])]),t._v(" "),n("p",[t._v("发现主从不一致了。")]),t._v(" "),n("p",[t._v("schema.xml文件")]),t._v(" "),n("p",[t._v("修改"),n("code",[t._v("<dataHost>")]),t._v("的balance属性，通过此属性配置读写分离的类型")]),t._v(" "),n("p",[t._v("负载均衡类型，目前的取值有4 种：")]),t._v(" "),n("ul",[n("li",[t._v('balance="0", 不开启读写分离机制， 所有读操作都发送到当前可用的 writeHost 上。')]),t._v(" "),n("li",[t._v('balance="1"，全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从 模式(M1->S1， M2->S2，并且 M1 与 M2 互为主备)，正常情况下， M2,S1,S2 都参与 select 语句的负载均衡。')]),t._v(" "),n("li",[t._v('balance="2"，所有读操作都随机的在 writeHost、 readhost 上分发。')]),t._v(" "),n("li",[t._v('balance="3"，所有读请求随机的分发到 readhost 执行， writerHost 不负担读压力')])]),t._v(" "),n("p",[n("strong",[n("font",{attrs:{color:"red"}},[t._v("一般设置为1或者3")])],1)]),t._v(" "),n("p",[t._v("为了能够让效果比较明显，将balance设置为2。")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.11"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("minCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("balance")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t\t\t  "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("writeType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbDriver")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("native"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("switchType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("  "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slaveThreshold")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("select user()"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- can have multi write hosts --\x3e")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("writeHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostM1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.11:3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t\t\t\t   "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- can have multi read hosts --\x3e")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("readHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostS1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.12:3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("writeHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("h3",{attrs:{id:"验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),n("ol",[n("li",[t._v("在写主机上插入INSERT INTO test VALUES(2,@@hostname);")]),t._v(" "),n("li",[t._v("在MyCat里面进行查询，会看到查询结果会在两台机器上切换")])]),t._v(" "),n("h2",{attrs:{id:"双主双从"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#双主双从"}},[t._v("#")]),t._v(" 双主双从")]),t._v(" "),n("p",[t._v("一个主机 m1 用于处理所有写请求，它的从机 s1 和另一台主机 m2 还有它的从机 s2 负责所有读请求。当 m1 主机宕机后，m2 主机负责写请求，m1、 m2 互为备机。架构图如下。")]),t._v(" "),n("p",[n("img",{attrs:{src:s(905),alt:""}})]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("主机")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("端口")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("密码")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("名称")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.11")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("3306")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("111111")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Master1")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.11")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("3307")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("111111")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Master2")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.12")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("3306")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("111111")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Slave1")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.25.12")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("3307")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("111111")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Slave2")])])])]),t._v(" "),n("h3",{attrs:{id:"主节点-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主节点-2"}},[t._v("#")]),t._v(" 主节点")]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Master1的配置文件")]),t._v("\n[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysql]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不区分大小写")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用二进制日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主服务器唯一ID")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#语法校验规则")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置logbin格式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("STATEMENT")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在作为从数据库的时候， 有写入操作也要更新二进制日志文件")]),t._v("\nlog-slave-updates\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1， 取值范围是1 .. 65535")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-increment-increment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表示自增长字段从哪个数开始，指字段一次递增多少，他的取值范围是1 .. 65535")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-increment-offset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不需要复制的库")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("information_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("performance_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("sys")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置需要复制的数据库")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-do-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("testdb")]),t._v("\n")])])]),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Master2的配置文件")]),t._v("\n[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysql]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不区分大小写")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用二进制日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主服务器唯一ID")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#语法校验规则")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置logbin格式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog_format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("STATEMENT")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在作为从数据库的时候， 有写入操作也要更新二进制日志文件")]),t._v("\nlog-slave-updates\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1， 取值范围是1 .. 65535")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-increment-increment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表示自增长字段从哪个数开始，指字段一次递增多少，他的取值范围是1 .. 65535")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-increment-offset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不需要复制的库")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("information_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("performance_schema")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-ignore-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("sys")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置需要复制的数据库")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("binlog-do-db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("testdb")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("111111")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4_general_ci\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master1/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master1/conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/mysql/\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master1/log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master1/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files/\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("111111")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4_general_ci\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3307"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master2/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master2/conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/mysql/\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master2/log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master2/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files/\n")])])]),n("h3",{attrs:{id:"从节点-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从节点-2"}},[t._v("#")]),t._v(" 从节点")]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Slave1的配置文件")]),t._v("\n[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用二进制日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server-id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不区分大小写")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用中继日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("relay-log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-relay")]),t._v("\n")])])]),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Slave2的配置文件")]),t._v("\n[client]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-character-set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("utf8mb4")]),t._v("\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default-authentication-plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql_native_password")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("explicit_defaults_for_timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用二进制日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log-bin")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-bin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("log_bin_trust_function_creators")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server-id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("4")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不区分大小写")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lower_case_table_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sql_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用中继日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("relay-log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mysql-relay")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#docker-compose.yml")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" slave1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("111111")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4_general_ci\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/mysql/\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files/\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" slave2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("111111")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4_general_ci\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3307"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/mysql/\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("files/\n")])])]),n("h3",{attrs:{id:"授权账号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#授权账号"}},[t._v("#")]),t._v(" 授权账号")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在主机MySQL里执行授权命令")]),t._v("\nCREATE "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),t._v(" IDENTIFIED WITH mysql_native_password BY "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'111111'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nGRANT REPLICATION SLAVE ON *.* TO "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询Master1和2的状态")]),t._v("\nshow master status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#分别记录下File和Position的值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化！！！")]),t._v("\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在从主机上执行")]),t._v("\nCHANGE MASTER TO "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_HOST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.25.11'")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slave'")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'111111'")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(",  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#需要指定，slave1对应的3306，slave2对应的3307")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_LOG_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql-bin.000003'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#记录的值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MASTER_LOG_POS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("663")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\nSTART SLAVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看状态")]),t._v("\nshow slave status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Slave_IO_Running: Yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Slave_SQL_Running: Yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#证明搭建完成")]),t._v("\n")])])]),n("h3",{attrs:{id:"修改mycat配置文件-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改mycat配置文件-2"}},[t._v("#")]),t._v(" 修改MyCat配置文件")]),t._v(" "),n("p",[t._v("修改schema.xml")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0"?>')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("mycat:schema")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("SYSTEM")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"schema.dtd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("schema")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("mycat")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://io.mycat/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("schema")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("TESTDB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("checkSQLschema")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sqlMaxLimit")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataNode")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dn1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("schema")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataNode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dn1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataHost")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("host1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("database")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("testdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("host1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("maxCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("minCon")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("balance")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("writeType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbDriver")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("native"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("switchType")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slaveThreshold")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("select user()"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("heartbeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- can have multi write hosts --\x3e")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("writeHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostM1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.11:3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- can have multi read hosts --\x3e")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("readHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostS1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.12:3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("writeHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("writeHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostM2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.11:3307"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- can have multi read hosts --\x3e")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("readHost")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hostS2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("192.168.25.12:3307"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("111111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("writeHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("mycat:")]),t._v("schema")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("ul",[n("li",[t._v('writeType="0": 所有写操作发送到配置的第一个writeHost，第一个挂了切到还生存的第二个。')]),t._v(" "),n("li",[t._v('writeType="1"，所有写操作都随机的发送到配置的 writeHost， 1.5 以后废弃不推荐。')]),t._v(" "),n("li",[t._v("writeHost，重新启动后以切换后的为准，切换记录在配置文件中:dnindex.properties。")]),t._v(" "),n("li",[t._v('switchType="1": 1 默认值，自动切换。\n'),n("ul",[n("li",[t._v("-1 表示不自动切换。")]),t._v(" "),n("li",[t._v("2 基于 MySQL 主从同步的状态决定是否切换。")])])])])])}),[],!1,null,null,null);a.default=e.exports},902:function(t,a,s){t.exports=s.p+"assets/img/XP826O.ce4c84f5.png"},903:function(t,a,s){t.exports=s.p+"assets/img/XPGtUA.f976ae38.png"},904:function(t,a,s){t.exports=s.p+"assets/img/XPGg5n.21da5102.png"},905:function(t,a,s){t.exports=s.p+"assets/img/XFbbkV.c0e04357.png"}}]);