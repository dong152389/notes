(window.webpackJsonp=window.webpackJsonp||[]).push([[395],{1613:function(t,e,s){"use strict";s.r(e);var a=s(26),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"使用-kubeadm-配置-slave-节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubeadm-配置-slave-节点"}},[t._v("#")]),t._v(" 使用 kubeadm 配置 slave 节点")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("将 slave 节点加入到集群中很简单，只需要在 slave 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 "),s("code",[t._v("kubeadm join")]),t._v(" 命令加入即可。准备工作如下：")]),t._v(" "),s("ul",[s("li",[t._v("修改主机名")]),t._v(" "),s("li",[t._v("配置软件源")]),t._v(" "),s("li",[t._v("安装三个工具")])]),t._v(" "),s("p",[t._v("由于之前章节已经说明了操作步骤，此处不再赘述。")]),t._v(" "),s("h2",{attrs:{id:"将-slave-加入到集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将-slave-加入到集群"}},[t._v("#")]),t._v(" 将 slave 加入到集群")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:cab7c86212535adde6b8d1c7415e81847715cfc8629bb1d270b601744d662515\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装成功将看到如下信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -oyaml'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Downloading configuration "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet from the "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.14"')]),t._v(" ConfigMap "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the kube-system namespace\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Activating the kubelet "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl get nodes'")]),t._v(" on the control-plane to see this node "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" the cluster.\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[t._v("token\n"),s("ul",[s("li",[t._v("可以通过安装 master 时的日志查看 token 信息")]),t._v(" "),s("li",[t._v("可以通过 "),s("code",[t._v("kubeadm token list")]),t._v(" 命令打印出 token 信息")]),t._v(" "),s("li",[t._v("如果 token 过期，可以使用 "),s("code",[t._v("kubeadm token create")]),t._v(" 命令创建新的 token")])])]),t._v(" "),s("li",[t._v("discovery-token-ca-cert-hash\n"),s("ul",[s("li",[t._v("可以通过安装 master 时的日志查看 sha256 信息")]),t._v(" "),s("li",[t._v("可以通过 "),s("code",[t._v("openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'")]),t._v(" 命令查看 sha256 信息")])])])]),t._v(" "),s("h2",{attrs:{id:"验证是否成功"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),s("p",[t._v("回到 master 服务器")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get nodes\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到 slave 成功加入 master")]),t._v("\nNAME                STATUS     ROLES    AGE   VERSION\nkubernetes-master   NotReady   master   9h    v1.14.1\nkubernetes-slave1   NotReady   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   22s   v1.14.1\n")])])]),s("blockquote",[s("p",[t._v("如果 slave 节点加入 master 时配置有问题可以在 slave 节点上使用 "),s("code",[t._v("kubeadm reset")]),t._v(" 重置配置再使用 "),s("code",[t._v("kubeadm join")]),t._v(" 命令重新加入即可。希望在 master 节点删除 node ，可以使用 "),s("code",[t._v("kubeadm delete nodes <NAME>")]),t._v(" 删除。")])]),t._v(" "),s("h2",{attrs:{id:"查看-pod-状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-状态"}},[t._v("#")]),t._v(" 查看 pod 状态")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pod -n kube-system -o wide\n\nNAME                                        READY   STATUS    RESTARTS   AGE   IP                NODE                NOMINATED NODE   READINESS GATES\ncoredns-8686dcc4fd-gwrmb                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncoredns-8686dcc4fd-j6gfk                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\netcd-kubernetes-master                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130   kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-apiserver-kubernetes-master            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130   kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-controller-manager-kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130   kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-496dr                            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          17m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.131   kubernetes-slave1   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-rsnb6                            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130   kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-scheduler-kubernetes-master            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          9h    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.130   kubernetes-master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("由此可以看出 coredns 尚未运行，此时我们还需要安装网络插件。")])])}),[],!1,null,null,null);e.default=n.exports}}]);