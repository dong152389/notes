(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1587:function(t,s,a){"use strict";a.r(s);var n=a(26),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"redis-主从复制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从复制"}},[t._v("#")]),t._v(" Redis 主从复制")]),t._v(" "),n("h2",{attrs:{id:"是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[t._v("#")]),t._v(" 是什么")]),t._v(" "),n("p",[t._v("主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制，"),n("font",{attrs:{color:"red"}},[n("strong",[t._v("Master以写为主，Slave以读为主")])]),t._v("。")],1),t._v(" "),n("h2",{attrs:{id:"能干嘛"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#能干嘛"}},[t._v("#")]),t._v(" 能干嘛")]),t._v(" "),n("ul",[n("li",[t._v("读写分离，性能扩展")]),t._v(" "),n("li",[t._v("容灾快速恢复")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(925),alt:"image-20221130165957242"}})]),t._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),n("ol",[n("li",[t._v("拷贝多个redis.conf文件include(写绝对路径)")]),t._v(" "),n("li",[n("font",{attrs:{color:"#007c6a"}},[t._v("开启daemonize yes")])],1),t._v(" "),n("li",[t._v("Pid文件名字pidfile")]),t._v(" "),n("li",[t._v("指定端口port")]),t._v(" "),n("li",[n("font",{attrs:{color:"#007c6a"}},[t._v("Log文件名字")])],1),t._v(" "),n("li",[t._v("dump.rdb名字dbfilename")]),t._v(" "),n("li",[n("font",{attrs:{color:"#007c6a"}},[t._v("Appendonly 关掉或者换名字")])],1)]),t._v(" "),n("h3",{attrs:{id:"新建-redis6379-conf-填写以下内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新建-redis6379-conf-填写以下内容"}},[t._v("#")]),t._v(" 新建 redis6379.conf，填写以下内容")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("include /root/myredis/redis.conf\npidfile /var/run/redis_6379.pid\nport 6379\ndbfilename dump6379.rdb\n")])])]),n("h3",{attrs:{id:"新建-redis6380-conf-填写以下内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新建-redis6380-conf-填写以下内容"}},[t._v("#")]),t._v(" 新建 redis6380.conf，填写以下内容")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("include /root/myredis/redis.conf\npidfile /var/run/redis_6380.pid\nport 6380\ndbfilename dump6380.rdb\nslave-priority 10\nslaveof 127.0.0.1 6379\n")])])]),n("h3",{attrs:{id:"新建-redis6381-conf-填写以下内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新建-redis6381-conf-填写以下内容"}},[t._v("#")]),t._v(" 新建 redis6381.conf，填写以下内容")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("include /root/myredis/redis.conf\npidfile /var/run/redis_6381.pid\nport 6381\ndbfilename dump6381.rdb\nslaveof 127.0.0.1 6379\n")])])]),n("blockquote",[n("p",[t._v("slave-priority 10")]),t._v(" "),n("p",[t._v("设置从机的优先级，值越小，优先级越高，用于选举主机时使用。默认100")])]),t._v(" "),n("h3",{attrs:{id:"启动三台-redis-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动三台-redis-服务器"}},[t._v("#")]),t._v(" 启动三台 Redis 服务器")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("redis-server ~/myredis/redis6379.conf\nredis-server ~/myredis/redis6380.conf\nredis-server ~/myredis/redis6381.conf\n")])])]),n("h3",{attrs:{id:"查看系统进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看系统进程"}},[t._v("#")]),t._v(" 查看系统进程")]),t._v(" "),n("p",[n("img",{attrs:{src:a(926),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"查看三台主机运行情况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看三台主机运行情况"}},[t._v("#")]),t._v(" 查看三台主机运行情况")]),t._v(" "),n("p",[n("code",[t._v("info replication")]),t._v("：打印主从复制的相关信息。")]),t._v(" "),n("h3",{attrs:{id:"配从-库-不配主-库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配从-库-不配主-库"}},[t._v("#")]),t._v(" 配从(库)不配主(库**)**")]),t._v(" "),n("p",[n("code",[t._v("slaveof <ip> <port>")]),t._v("：成为某个实例的从服务器。")]),t._v(" "),n("ol",[n("li",[t._v("在6380和6381上执行: "),n("code",[t._v("slaveof 127.0.0.1 6379")])]),t._v(" "),n("li",[t._v("在主机上写，在从机上可以读取数据，无法写入")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(927),alt:""}})]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("主机挂掉，重启就行，一切如初。")]),t._v(" "),n("li",[t._v("从机重启需重设："),n("code",[t._v("slaveof 127.0.0.1 6379")])])]),t._v(" "),n("p",[n("strong",[t._v("可以将配置增加到文件中。永久生效")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"安装-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[t._v("#")]),t._v(" 安装（Docker）")]),t._v(" "),n("p",[t._v("目录结构如下")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n├── docker-compose.yml\n├── master\n│   ├── conf\n│   │   └── redis.conf\n│   ├── data\n│   └── logs\n├── sentinel\n│   ├── sentinel-1\n│   │   ├── conf\n│   │   │   └── sentinel.conf\n│   │   └── data\n│   ├── sentinel-2\n│   │   ├── conf\n│   │   │   └── sentinel.conf\n│   │   └── data\n│   └── sentinel-3\n│       ├── conf\n│       │   └── sentinel.conf\n│       └── data\n├── slave1\n│   ├── conf\n│   │   └── redis.conf\n│   ├── data\n│   └── logs\n└── slave2\n    ├── conf\n    │   └── redis.conf\n    ├── data\n    └── logs\n")])])]),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master/conf/redis.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/redis/redis.conf\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/logs\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### 这里的slave-announce-ip、slave-announce-port是宿主机IP与端口，不设置的话哨兵模式下访问的是容器内IP端口，不能为外部应用提供服务，原因是由于端口或IP映射导致的无法连接的问题。例如 docker 这种容器，当你使用了端口映射后，运行在 docker 中的 redis 是不知道正真的端口或 IP 的，所以在哨兵模式下，哨兵就无法连接到 master 和 replica。当遇到这种情况后，其实还有另一种解决方式，就是直接使用 docker 的主机网络（启动时加上 --net=host）。")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/redis/redis.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--masterauth 111111"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-ip 192.168.25.10"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-port 6379"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/conf/redis.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/redis/redis.conf\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/logs      \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/redis/redis.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slaveof 192.168.25.10 6379"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--masterauth 111111"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-ip 192.168.25.10"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-port 6380"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/conf/redis.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/redis/redis.conf\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/logs          \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/redis/redis.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slaveof 192.168.25.10 6379"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--masterauth 111111"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-ip 192.168.25.10"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--slave-announce-port 6381"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis-sentinel-1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - ./sentinel-1/data:/data")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./sentinel/sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1/conf/sentinel.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-sentinel"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/etc/redis/sentinel.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave1\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave2\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis-sentinel-2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26380")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - ./sentinel-2/data:/data")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./sentinel/sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2/conf/sentinel.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-sentinel"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/etc/redis/sentinel.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave1\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave2\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis-sentinel-3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7.0.5\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26381")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - ./sentinel-3/data:/data")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./sentinel/sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3/conf/sentinel.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-sentinel"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/etc/redis/sentinel.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave1\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" slave2\n")])])]),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#redis.conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###看清配置项母，牵扯到端口或者IP的请自行修改")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#允许外部访问")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("bind")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0.0.0.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("protected-mode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("port")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("6380")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tcp-backlog")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("511")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("timeout")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tcp-keepalive")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("300")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("daemonize")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pidfile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/var/run/redis_6380.pid")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("loglevel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("notice")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("logfile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('""')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("databases")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("16")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("always-show-logo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("set-proc-title")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("proc-title-template")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"{title} {listen-addr} {server-mode}"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("stop-writes-on-bgsave-error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rdbcompression")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rdbchecksum")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dbfilename")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("dump.rdb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rdb-del-sync-files")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dir")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("./")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-serve-stale-data")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-read-only")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("repl-diskless-sync")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("repl-diskless-sync-delay")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("repl-diskless-sync-max-replicas")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("repl-diskless-load")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("disabled")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("repl-disable-tcp-nodelay")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-priority")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定宿主机的IP和端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-announce-ip")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.25.10")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-announce-port")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("6380")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("acllog-max-len")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("128")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#密码")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("requirepass")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("111111")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lazyfree-lazy-eviction")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lazyfree-lazy-expire")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lazyfree-lazy-server-del")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("replica-lazy-flush")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lazyfree-lazy-user-del")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lazyfree-lazy-user-flush")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("oom-score-adj")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("oom-score-adj-values")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0 200 800")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("disable-thp")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#RDB持久化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("save")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("900 1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#AOF持久化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("appendonly")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("appendfilename")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"appendonly.aof"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("appenddirname")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"appendonlydir"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("appendfsync")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("everysec")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("no-appendfsync-on-rewrite")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-aof-rewrite-percentage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auto-aof-rewrite-min-size")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64mb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("aof-load-truncated")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("aof-use-rdb-preamble")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("aof-timestamp-enabled")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slowlog-log-slower-than")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("slowlog-max-len")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("128")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("latency-monitor-threshold")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("notify-keyspace-events")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('""')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("hash-max-listpack-entries")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("512")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("hash-max-listpack-value")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("list-max-listpack-size")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("-2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("list-compress-depth")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("set-max-intset-entries")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("512")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("zset-max-listpack-entries")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("128")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("zset-max-listpack-value")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("hll-sparse-max-bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("stream-node-max-bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("4096")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("stream-node-max-entries")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("100")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("activerehashing")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("client-output-buffer-limit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("normal 0 0 0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("client-output-buffer-limit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("replica 256mb 64mb 60")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("client-output-buffer-limit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("pubsub 32mb 8mb 60")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("hz")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dynamic-hz")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("aof-rewrite-incremental-fsync")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rdb-save-incremental-fsync")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("jemalloc-bg-thread")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("yes")]),t._v("\n")])])]),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel.conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("####  根据Docker配置修改端口号或者IP####")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#哨兵的端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("port")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("26379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#工作路径")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dir")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"/data"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("protected-mode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("no")]),t._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指明日志文件名，一旦开启需要修改Docker配置中的映射地址，开启后docker中无日志，日在data文件夹中")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# logfile "/data/sentinel.log"')]),t._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# master表示 哨兵监控master服务的别名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.25.10 表示 master地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2 表示只需要2个sentinel投票即可故障转移")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("monitor mymaster 192.168.25.10 6379 2")]),t._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#这两项配置非常重要，不同哨兵的节点通信的地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("announce-ip 192.168.25.10")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("announce-port 26379")]),t._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于验证主节点和副本的密码")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("auth-pass mymaster 111111")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("down-after-milliseconds mymaster 30000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("parallel-syncs mymaster 1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("failover-timeout mymaster 180000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("sentinel")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("deny-scripts-reconfig yes")]),t._v("\n")])])]),n("h2",{attrs:{id:"常用-3-招"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用-3-招"}},[t._v("#")]),t._v(" 常用 3 招")]),t._v(" "),n("h3",{attrs:{id:"一主二仆"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一主二仆"}},[t._v("#")]),t._v(" 一主二仆")]),t._v(" "),n("ul",[n("li",[t._v("切入点问题？slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？从机是否可以写？set可否？\n"),n("ul",[n("li",[t._v("能复制。")]),t._v(" "),n("li",[t._v("不可")])])])]),t._v(" "),n("p",[t._v("主机shutdown后情况如何？从机是上位还是原地待命？")]),t._v(" "),n("p",[t._v("主机又回来了后，主机新增记录，从机还能否顺利复制？")]),t._v(" "),n("p",[t._v("其中一台从机down后情况如何？依照原有它能跟上大部队吗？")]),t._v(" "),n("p",[n("img",{attrs:{src:a(928),alt:"image-20221201163538464"}})]),t._v(" "),n("h3",{attrs:{id:"薪火相传"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#薪火相传"}},[t._v("#")]),t._v(" 薪火相传")]),t._v(" "),n("p",[t._v("上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master，可以有效减轻master的写压力，去中心化降低风险。")]),t._v(" "),n("p",[t._v("用 "),n("code",[t._v("slaveof <ip> <port>")])]),t._v(" "),n("p",[t._v("中途变更转向：会清除之前的数据，重新建立拷贝最新的。")]),t._v(" "),n("p",[t._v("风险是一旦某个slave宕机，后面的slave都没法备份。"),n("font",{attrs:{color:"red"}},[n("strong",[t._v("主机挂了，从机还是从机，无法写数据了。")])])],1),t._v(" "),n("p",[n("img",{attrs:{src:a(929),alt:"image-20221202102122267"}})]),t._v(" "),n("h3",{attrs:{id:"反客为主"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#反客为主"}},[t._v("#")]),t._v(" 反客为主")]),t._v(" "),n("p",[t._v("当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(930),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"复制原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制原理"}},[t._v("#")]),t._v(" 复制原理")]),t._v(" "),n("ul",[n("li",[t._v("Slave启动成功连接到master后会发送一个sync命令。")]),t._v(" "),n("li",[t._v("Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave，以完成一次完全同步。")]),t._v(" "),n("li",[t._v("全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。")]),t._v(" "),n("li",[t._v("增量复制：Master继续将新的所有收集到的修改命令依次传给slave，完成同步。")]),t._v(" "),n("li",[t._v("但是只要是重新连接master，一次完全同步（全量复制）将被自动执行。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(931),alt:"image-20221202105225517"}})]),t._v(" "),n("h2",{attrs:{id:"哨兵模式-sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式-sentinel"}},[t._v("#")]),t._v(" 哨兵模式（sentinel）")]),t._v(" "),n("h3",{attrs:{id:"是什么-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是什么-2"}},[t._v("#")]),t._v(" 是什么")]),t._v(" "),n("p",[n("strong",[t._v("反客为主的自动版")]),t._v("，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(932),alt:"image-20221202105613448"}})]),t._v(" "),n("h3",{attrs:{id:"使用步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用步骤"}},[t._v("#")]),t._v(" 使用步骤")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("调整为一主二仆模式，6379带着6380、6381。")])]),t._v(" "),n("li",[n("p",[t._v("自定义的 myredis 目录下新建 sentinel.conf 文件，名字绝不能错。")])]),t._v(" "),n("li",[n("p",[t._v("配置哨兵，填写内容。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("sentinel monitor mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。 ")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("启动哨兵")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("/usr/local/bin/redis-sentinel ~/myredis/sentinel.conf \n")])])]),n("p",[n("img",{attrs:{src:a(933),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("当主机挂掉，从机选举中产生新的主机(大概10秒左右可以看到哨兵窗口日志，切换了新的主机)，哪个从机会被选举为主机呢？根据优先级别：slave-priority ，原主机重启后会变为从机。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(934),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("通过图形化工具连接26379端口即可访问sentinel")])])]),t._v(" "),n("h3",{attrs:{id:"复制延时"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制延时"}},[t._v("#")]),t._v(" 复制延时")]),t._v(" "),n("p",[t._v("由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。")]),t._v(" "),n("h3",{attrs:{id:"故障恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#故障恢复"}},[t._v("#")]),t._v(" 故障恢复")]),t._v(" "),n("p",[n("img",{attrs:{src:a(935),alt:"image-20221202150028596"}})]),t._v(" "),n("p",[t._v("优先级在redis.conf中默认：slave-priority 100，值越小优先级越高，偏移量是指获得原主机数据最全的，每个redis实例启动后都会随机生成一个40位的runid。")]),t._v(" "),n("h2",{attrs:{id:"代码修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码修改"}},[t._v("#")]),t._v(" 代码修改")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在修改代码之前需要将sentinel.conf中的IP修改为真实IP，sentinel monitor mymaster 192.168.25.100 6381 1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 否则会一直抛出Reason: redis.clients.jedis.exceptions.JedisConnectionException")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SentinelJedisPool")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JedisSentinelPool")]),t._v(" pool "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//可用连接实例的最大数目，默认为8；")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果赋值为-1，则表示不限制，如果pool已经分配了maxActive个jedis实例，则此时pool的状态为exhausted(耗尽)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" MAX_TOTAL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//控制一个pool最多有多少个状态为idle(空闲)的jedis实例，默认值是8")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" MAX_IDLE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//等待可用连接的最大时间，单位是毫秒，默认值为-1，表示永不超时。")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果超过等待时间，则直接抛出JedisConnectionException")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" MAX_WAIT_MILLIS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//客户端超时时间配置")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" TIMEOUT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在borrow(用)一个jedis实例时，是否提前进行validate(验证)操作；")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果为true，则得到的jedis实例均是可用的")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),t._v(" TEST_ON_BORROW "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在空闲时检查有效性, 默认false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),t._v(" TEST_WHILE_IDLE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否进行有效性检查")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),t._v(" TEST_ON_RETURN "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 创建连接池\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createJedisPool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JedisPoolConfig")]),t._v(" config "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JedisPoolConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*注意：\n            在高版本的jedis jar包，比如本版本2.9.0，JedisPoolConfig没有setMaxActive和setMaxWait属性了\n            这是因为高版本中官方废弃了此方法，用以下两个属性替换。\n            maxActive  ==>  maxTotal\n            maxWait==>  maxWaitMillis\n         */")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxTotal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MAX_TOTAL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxIdle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MAX_IDLE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxWaitMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MAX_WAIT_MILLIS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTestOnBorrow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TEST_ON_BORROW"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTestWhileIdle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TEST_WHILE_IDLE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTestOnReturn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TEST_ON_RETURN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" masterName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mymaster"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" sentinels "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashSet")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        sentinels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HostAndPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.25.100"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        String password = "1234@abcd";')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//        pool = new JedisSentinelPool(masterName, sentinels, config, TIMEOUT,password);")]),t._v("\n        pool "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JedisSentinelPool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("masterName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sentinels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TIMEOUT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("poolInit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pool "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createJedisPool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 获取一个redis对象\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Jedis")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getJedis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pool "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("poolInit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" pool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports},925:function(t,s,a){t.exports=a.p+"assets/img/image-20221130165957242.42d69a1f.png"},926:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2022-12-01_14-47-17.4480544c.png"},927:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2022-12-01_15-07-29.9e82b498.png"},928:function(t,s,a){t.exports=a.p+"assets/img/image-20221201163538464.8c790464.png"},929:function(t,s,a){t.exports=a.p+"assets/img/image-20221202102122267.98697c8f.png"},930:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2022-12-02_10-22-44.75f24e33.png"},931:function(t,s,a){t.exports=a.p+"assets/img/image-20221202105225517.754e40be.png"},932:function(t,s,a){t.exports=a.p+"assets/img/image-20221202105613448.302770e1.png"},933:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2022-12-02_13-59-52.d8fc17d5.png"},934:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2022-12-02_14-05-59.12d10288.png"},935:function(t,s,a){t.exports=a.p+"assets/img/image-20221202150028596.ffdf0e3a.png"}}]);