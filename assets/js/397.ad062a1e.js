(window.webpackJsonp=window.webpackJsonp||[]).push([[397],{1618:function(s,a,t){"use strict";t.r(a);var e=t(26),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"第一个-kubernetes-容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一个-kubernetes-容器"}},[s._v("#")]),s._v(" 第一个 Kubernetes 容器")]),s._v(" "),t("h2",{attrs:{id:"检查组件运行状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查组件运行状态"}},[s._v("#")]),s._v(" 检查组件运行状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get cs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME                 STATUS    MESSAGE             ERROR\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调度服务，主要作用是将 POD 调度到 Node")]),s._v("\nscheduler            Healthy   ok                  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动化修复服务，主要作用是 Node 宕机后自动修复 Node 回到正常的工作状态")]),s._v("\ncontroller-manager   Healthy   ok                  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务注册与发现")]),s._v("\netcd-0               Healthy   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])])]),t("h2",{attrs:{id:"检查-master-状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查-master-状态"}},[s._v("#")]),s._v(" 检查 Master 状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl cluster-info\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主节点状态")]),s._v("\nKubernetes master is running at https://192.168.141.130:6443\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNS 状态")]),s._v("\nKubeDNS is running at https://192.168.141.130:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubectl cluster-info dump'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("h2",{attrs:{id:"检查-nodes-状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查-nodes-状态"}},[s._v("#")]),s._v(" 检查 Nodes 状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get nodes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下，STATUS 为 Ready 即为正常状态")]),s._v("\nNAME                STATUS   ROLES    AGE     VERSION\nkubernetes-master   Ready    master   44h     v1.14.1\nkubernetes-slave1   Ready    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   3h38m   v1.14.1\nkubernetes-slave2   Ready    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   3h37m   v1.14.1\n")])])]),t("h2",{attrs:{id:"运行第一个容器实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行第一个容器实例"}},[s._v("#")]),s._v(" 运行第一个容器实例")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 kubectl 命令创建两个监听 80 端口的 Nginx Pod（Kubernetes 运行容器的最小单元）")]),s._v("\nkubectl run nginx --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nkubectl run --generator"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("deployment/apps.v1 is DEPRECATED and will be removed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a future version. Use kubectl run --generator"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("run-pod/v1 or kubectl create instead.\ndeployment.apps/nginx created\n")])])]),t("h2",{attrs:{id:"查看全部-pods-的状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看全部-pods-的状态"}},[s._v("#")]),s._v(" 查看全部 Pods 的状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get pods\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下，需要等待一小段实践，STATUS 为 Running 即为运行成功")]),s._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-755464dd6c-qnmwp   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          90m\nnginx-755464dd6c-shqrp   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          90m\n")])])]),t("h2",{attrs:{id:"查看已部署的服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看已部署的服务"}},[s._v("#")]),s._v(" 查看已部署的服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get deployment\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           91m\n")])])]),t("h2",{attrs:{id:"映射服务-让用户可以访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#映射服务-让用户可以访问"}},[s._v("#")]),s._v(" 映射服务，让用户可以访问")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl expose deployment nginx --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LoadBalancer\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nservice/nginx exposed\n")])])]),t("h2",{attrs:{id:"查看已发布的服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看已发布的服务"}},[s._v("#")]),s._v(" 查看已发布的服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get services\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nNAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nkubernetes   ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        44h\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由此可见，Nginx 服务已成功发布并将 80 端口映射为 31738")]),s._v("\nnginx        LoadBalancer   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.108")]),s._v(".121.244   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pending"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":31738/TCP   88m\n")])])]),t("h2",{attrs:{id:"查看服务详情"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看服务详情"}},[s._v("#")]),s._v(" 查看服务详情")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl describe "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nName:                     nginx\nNamespace:                default\nLabels:                   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\nAnnotations:              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSelector:                 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\nType:                     LoadBalancer\nIP:                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.108")]),s._v(".121.244\nPort:                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP\nTargetPort:               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP\nNodePort:                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31738")]),s._v("/TCP\nEndpoints:                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".17.5:80,192.168.8.134:80\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h2",{attrs:{id:"验证是否成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功"}},[s._v("#")]),s._v(" 验证是否成功")]),s._v(" "),t("p",[s._v("通过浏览器访问 Master 服务器")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://192.168.141.130:31738/\n")])])]),t("p",[s._v("此时 Kubernetes 会以负载均衡的方式访问部署的 Nginx 服务，能够正常看到 Nginx 的欢迎页即表示成功。容器实际部署在其它 Node 节点上，通过访问 Node 节点的 IP:Port 也是可以的。")]),s._v(" "),t("h2",{attrs:{id:"停止服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止服务"}},[s._v("#")]),s._v(" 停止服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl delete deployment nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\ndeployment.extensions "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(" deleted\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl delete "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(" deleted\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);